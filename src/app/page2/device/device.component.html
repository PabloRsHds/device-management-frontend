<div class="body">

  <div class="sidebar">
    <div class="sidebar-header">
      <h3>Device Management</h3>
      <div class="separator"></div>
    </div>
    <div class="sidebar-menu">
      <button class="menu-button"
        *ngFor="let button of buttons"
        (click)="toggleButton(button.id)"
        [ngClass]="{'button-pressed':button.pressed}">
          {{button.title}}
      </button>
    </div>
  </div>

  <div class="main-content" *ngIf="!buttons[0].pressed && !buttons[1].pressed && !buttons[2].pressed">
    <div class="welcome-container">
      <h1 class="welcome-title">Welcome to Device Management</h1>
      <p class="welcome-subtitle">This is the place where you can manage your devices</p>
    </div>
  </div>

  <div class="main-content-form" *ngIf="buttons[0].pressed">
    <div class="form-container">
      <h1 class="form-title">Register Device</h1>

      <form method="post" [formGroup]="registerForm" (ngSubmit)="onSubmit()">
        <div class="form-group">
          <input type="text" formControlName="name" class="form-input" placeholder="Enter device name">
        </div>

        <div class="form-group">
          <input type="text" formControlName="type" class="form-input" placeholder="Enter device type">
        </div>

        <div class="form-group">
          <input type="text" formControlName="deviceModel" class="form-input" placeholder="Enter device model">
        </div>

        <div class="form-group">
          <input type="text" formControlName="description" class="form-input" placeholder="Enter description">
        </div>

        <div class="form-group">
          <input type="text" formControlName="manufacturer" class="form-input" placeholder="Enter manufacturer">
        </div>

        <div class="form-group">
          <input type="number" formControlName="minLimit" class="form-input" placeholder="Enter a minLimit">
        </div>

        <div class="form-group">
          <input type="number" formControlName="maxLimit" class="form-input" placeholder="Enter a maxLimit">
        </div>

        <div class="form-group">
          <input type="text" formControlName="unit" class="form-input" placeholder="Enter a unit">
        </div>

        <div class="form-group">
          <input type="text" formControlName="location" class="form-input" placeholder="Enter a location">
        </div>

        <div class="form-buttons">
          <button type="submit" class="form-button register-button" [disabled]="registerForm.invalid">Register</button>
          <button type="button" class="form-button cancel-button">Cancel</button>
        </div>
      </form>

    </div>
  </div>

  <div class="main-content-table" *ngIf="buttons[1].pressed">

    <div class="table-container">

      <div class="search-container">
        <h2 class="table-title">All Devices</h2>
        <input type="text" placeholder="Search" class="search-input">
      </div>

      <div style="padding: 20px;">
        <table class="device-table">
          <thead>
            <tr>
              <th>Device Name</th>
              <th>Type</th>
              <th>Model</th>
              <th>Description</th>
              <th>Manufacturer</th>
              <th>Min Limit</th>
              <th>Max Limit</th>
              <th>Unit</th>
              <th>Location</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody *ngFor="let device of listDevices">
            <tr>
              <td>{{device.name}}</td>
              <td>{{device.type}}</td>
              <td>{{device.deviceModel}}</td>
              <td>{{device.manufacturer}}</td>
              <td>{{device.description}}</td>
              <td>{{device.minLimit}}</td>
              <td>{{device.maxLimit}}</td>
              <td>{{device.unit}}</td>
              <td>{{device.location}}</td>
              <td class="action-buttons">
                <button class="action-button test-button">Test</button>
                <button class="action-button edit-button" (click)="openModalDeviceUpdate = !openModalDeviceUpdate">Edit</button>
                <button class="action-button delete-button" (click)="openModalDeviceDelete = !openModalDeviceDelete">Delete</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Device Update Modal -->
  <div class="update-modal" *ngIf="openModalDeviceUpdate">
    <div class="update-modal-content">
      <div>
        <div class="form-container" [ngClass]="{'form-container-update': openModalDeviceUpdate}">
          <p class="close-button-update" (click)="openModalDeviceUpdate = !openModalDeviceUpdate">X</p>
          <h1 class="form-title">Update Device</h1>

          <form>
            <div class="form-group">
              <input type="text" id="deviceName" class="form-input" placeholder="Enter device name">
            </div>

            <div class="form-group">
              <input type="text" id="deviceType" class="form-input" placeholder="Enter device type">
            </div>

            <div class="form-group">
              <input type="text" id="deviceModel" class="form-input" placeholder="Enter device model">
            </div>

            <div class="form-group">
              <input type="text" id="description" class="form-input" placeholder="Enter description">
            </div>

            <div class="form-group">
              <input type="text" id="manufacturer" class="form-input" placeholder="Enter manufacturer">
            </div>

            <div class="form-group">
              <input type="number" id="minLimit" class="form-input" placeholder="Enter a minLimit">
            </div>

            <div class="form-group">
              <input type="number" id="maxLimit" class="form-input" placeholder="Enter a maxLimit">
            </div>

            <div class="form-group">
              <input type="text" id="unit" class="form-input" placeholder="Enter a unit">
            </div>

            <div class="form-group">
              <input type="text" id="location" class="form-input" placeholder="Enter a location">
            </div>

            <div class="form-buttons">
              <button type="button" class="form-button register-button">Update</button>
              <button type="button" class="form-button cancel-button">Cancel</button>
            </div>
          </form>
        </div>
      </div>

    </div>
  </div>
  <!---->

  <!-- Device Delete Modal -->

  <div class="delete-modal" *ngIf="openModalDeviceDelete">
    <div class="delete-modal-content">
      <p class="close-button" (click)="openModalDeviceDelete = !openModalDeviceDelete">X</p>

      <div style="display: flex; align-items: center; flex-direction: column;">
        <h1 class="delete-modal-title">Delete Device</h1>
        <p class="delete-modal-text">Are you sure you want to delete this device?</p>
        <div class="delete-modal-buttons">
          <button type="button" class="delete-modal-button">Delete</button>
          <button type="button" class="delete-modal-button-cancel" (click)="openModalDeviceDelete = !openModalDeviceDelete">Cancel</button>
        </div>
      </div>

    </div>
  </div>

  <!---->

  <!-- Device Analysis Modal -->
  <div class="analysis-modal" *ngIf="openModalTableInspection">
    <div class="modal-content">
      <p class="close-button" (click)="openModalTableInspection = !openModalTableInspection">X</p>

      <div class="modal-title">
        <h1>Device Settings</h1>
        <p>Configuration monitoring and history</p>
        <div class="reload-button">
          <button (click)="reloadAnalysis()">Reload</button>
        </div>
      </div>

      <div class="modal-cards">

        <div class="card-1">
          <h2>Current Settings</h2>
          <div>
            <p>Min limit <span class="span-color-settings">{{deviceModel.minLimit}}</span></p>
            <p>Max limit <span class="span-color-settings">{{deviceModel.maxLimit}}</span></p>
            <p>CreatedAt <span>{{deviceModel.createdAt}}</span></p>
            <p style="border-bottom: none;">UpdateAt <span>{{deviceModel.updatedAt}}</span></p>
          </div>
        </div>

        <div class="card-2">
          <h2>Previous configuration</h2>
          <div>
            <p>Min limit <span class="span-color-settings">{{deviceModel.lastReadingMinLimit}}</span></p>
            <p>Max limit <span class="span-color-settings">{{deviceModel.lastReadingMaxLimit}}</span></p>
            <p style="border-bottom: none;">UpdateAt <span>{{deviceModel.lastReadingUpdateAt}}</span></p>
          </div>
        </div>

      </div>
    </div>

  </div>

  <!---->

  <div class="main-content-analysis" *ngIf="buttons[2].pressed">

    <div class="analysis-container">

      <div class="search-container">
        <h2 class="analysis-title">Real-time Device Analysis</h2>
        <input type="text" placeholder="Search" class="search-input">
      </div>

      <div style="padding: 20px;">
        <table class="devices-table" >
          <thead>
            <tr>
              <th>Device Name</th>
              <th>Type</th>
              <th>Current Value</th>
              <th>Previous Value</th>
              <th>Change</th>
              <th>Unit</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody *ngFor="let device of listDevicesAnalysis" (click)="deviceForAnalysis(device.deviceModel)">
            <tr>
              <td>{{device.name}}</td>
              <td>{{device.type}}</td>
              <td class="current-value">{{device.minLimit}}</td>
              <td class="previous-value">{{device.maxLimit}}</td>
              <td><span class="value-change value-increase">A</span></td>
              <td>{{device.unit}}</td>
              <td><span class="status-indicator status-active"></span>Active</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

</div>
