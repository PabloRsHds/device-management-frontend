<div class="main-content-table">
  <div class="container">
    <div class="table-container">
      <div class="table-wrapper">
        <!-- Header com título e notificações -->
        <div class="table-header">
          <h2 class="table-title">All Devices</h2>
          <app-notifications class="notifications-component"></app-notifications>
        </div>

        <!-- Campo de busca -->
        <div class="search-box">
          <input
            type="text"
            (input)="onSearchInput($event)"
            placeholder="Search devices by name, model, type or manufacturer..."
            class="search-input"
          >
          <span class="search-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" fill="currentColor">
              <path d="M480 272C480 317.9 465.1 360.3 440 394.7L566.6 521.4C579.1 533.9 579.1 554.2 566.6 566.7C554.1 579.2 533.8 579.2 521.3 566.7L394.7 440C360.3 465.1 317.9 480 272 480C157.1 480 64 386.9 64 272C64 157.1 157.1 64 272 64C386.9 64 480 157.1 480 272zM272 416C351.5 416 416 351.5 416 272C416 192.5 351.5 128 272 128C192.5 128 128 192.5 128 272C128 351.5 192.5 416 272 416z"/>
            </svg>
          </span>
        </div>

        <!-- Tabela de dispositivos -->
        <div class="table-responsive">
          <table class="device-table">
            <thead>
              <tr>
                <th class="expand-name">Device Name</th>
                <th>Type</th>
                <th class="expand-model">Model</th>
                <th>Description</th>
                <th class="expand-manufacturer">Manufacturer</th>
                <th>Min Limit</th>
                <th>Max Limit</th>
                <th>Unit</th>
                <th>Location</th>
                <th colspan="3" class="actions-column">Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let device of (paginatedDevices$ | async)">
                <td data-label="Device Name">{{device.name}}</td>
                <td data-label="Type">
                  <span class="device-type">{{device.type}}</span>
                </td>
                <td data-label="Model">{{device.deviceModel}}</td>
                <td data-label="Description" class="td-cell">
                  <button
                    class="button-info description-btn"
                    (click)="functionTableInspection(device.description)"
                    [title]="device.description || 'No description'"
                  >
                    View
                    <span class="icon-book">
                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" fill="currentColor">
                        <path d="M480 576L192 576C139 576 96 533 96 480L96 160C96 107 139 64 192 64L496 64C522.5 64 544 85.5 544 112L544 400C544 420.9 530.6 438.7 512 445.3L512 512C529.7 512 544 526.3 544 544C544 561.7 529.7 576 512 576L480 576zM192 448C174.3 448 160 462.3 160 480C160 497.7 174.3 512 192 512L448 512L448 448L192 448zM224 216C224 229.3 234.7 240 248 240L424 240C437.3 240 448 229.3 448 216C448 202.7 437.3 192 424 192L248 192C234.7 192 224 202.7 224 216zM248 288C234.7 288 224 298.7 224 312C224 325.3 234.7 336 248 336L424 336C437.3 336 448 325.3 448 312C448 298.7 437.3 288 424 288L248 288z"/>
                      </svg>
                    </span>

                  </button>
                </td>
                <td data-label="Manufacturer">{{device.manufacturer}}</td>
                <td data-label="Min Limit">
                  <span class="limit-value" class="td-cell">{{device.minLimit}}</span>
                </td>
                <td data-label="Max Limit" class="td-cell">
                  <span class="limit-value">{{device.maxLimit}}</span>
                </td>
                <td data-label="Unit" class="td-cell">
                  <span class="unit-badge">{{device.unit}}</span>
                </td>
                <td data-label="Location" class="td-cell">
                  <button
                    class="button-info location-btn"
                    (click)="functionTableInspection(device.location)"
                    [title]="device.location || 'No location'"
                  >
                  View
                    <span class="icon-location">

                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" fill="currentColor">
                        <path d="M352 348.4C416.1 333.9 464 276.5 464 208C464 128.5 399.5 64 320 64C240.5 64 176 128.5 176 208C176 276.5 223.9 333.9 288 348.4L288 544C288 561.7 302.3 576 320 576C337.7 576 352 561.7 352 544L352 348.4zM328 160C297.1 160 272 185.1 272 216C272 229.3 261.3 240 248 240C234.7 240 224 229.3 224 216C224 158.6 270.6 112 328 112C341.3 112 352 122.7 352 136C352 149.3 341.3 160 328 160z"/>
                      </svg>
                    </span>
                  </button>
                </td>
                <td class="action-cell" data-label="Test">
                  <button class="action-button test-button"
                    (click)="handleChangeStatus(device.deviceModel)"
                    title="Test Device">

                    <span class="icon-energy">
                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" fill="currentColor">
                        <path d="M434.8 54.1C446.7 62.7 451.1 78.3 445.7 91.9L367.3 288L512 288C525.5 288 537.5 296.4 542.1 309.1C546.7 321.8 542.8 336 532.5 344.6L244.5 584.6C233.2 594 217.1 594.5 205.2 585.9C193.3 577.3 188.9 561.7 194.3 548.1L272.7 352L128 352C114.5 352 102.5 343.6 97.9 330.9C93.3 318.2 97.2 304 107.5 295.4L395.5 55.4C406.8 46 422.9 45.5 434.8 54.1z"/>
                      </svg>
                    </span>

                    Test
                  </button>
                </td>
                <td class="action-cell" data-label="Update">
                  <button class="action-button edit-button"
                    (click)="functionGetDeviceModelForUpdate(device.deviceModel)"
                    title="Update Device">

                    <span class="icon-pen">
                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" fill="currentColor">
                        <path d="M416.9 85.2L372 130.1L509.9 268L554.8 223.1C568.4 209.6 576 191.2 576 172C576 152.8 568.4 134.4 554.8 120.9L519.1 85.2C505.6 71.6 487.2 64 468 64C448.8 64 430.4 71.6 416.9 85.2zM338.1 164L122.9 379.1C112.2 389.8 104.4 403.2 100.3 417.8L64.9 545.6C62.6 553.9 64.9 562.9 71.1 569C77.3 575.1 86.2 577.5 94.5 575.2L222.3 539.7C236.9 535.6 250.2 527.9 261 517.1L476 301.9L338.1 164z"/>
                      </svg>
                    </span>

                    Update
                  </button>
                </td>
                <td class="action-cell" data-label="Delete">
                  <button class="action-button delete-button"
                    (click)="functionGetDeviceModelForDelete(device.deviceModel)"
                    title="Delete Device">

                    <span class="icon-trash">
                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" fill="currentColor">
                        <path d="M232.7 69.9C237.1 56.8 249.3 48 263.1 48L377 48C390.8 48 403 56.8 407.4 69.9L416 96L512 96C529.7 96 544 110.3 544 128C544 145.7 529.7 160 512 160L128 160C110.3 160 96 145.7 96 128C96 110.3 110.3 96 128 96L224 96L232.7 69.9zM128 208L512 208L512 512C512 547.3 483.3 576 448 576L192 576C156.7 576 128 547.3 128 512L128 208zM216 272C202.7 272 192 282.7 192 296L192 488C192 501.3 202.7 512 216 512C229.3 512 240 501.3 240 488L240 296C240 282.7 229.3 272 216 272zM320 272C306.7 272 296 282.7 296 296L296 488C296 501.3 306.7 512 320 512C333.3 512 344 501.3 344 488L344 296C344 282.7 333.3 272 320 272zM424 272C410.7 272 400 282.7 400 296L400 488C400 501.3 410.7 512 424 512C437.3 512 448 501.3 448 488L448 296C448 282.7 437.3 272 424 272z"/>
                      </svg>
                    </span>

                    Delete
                  </button>
                </td>
              </tr>
              <tr *ngIf="(paginatedDevices$ | async)?.length === 0">
              <td colspan="10" class="no-data">
                <div class="empty-state">
                  <span class="icon-satelite">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" fill="currentColor">
                      <path d="M296 64C450.6 64 576 189.4 576 344C576 357.3 565.3 368 552 368C538.7 368 528 357.3 528 344C528 215.9 424.1 112 296 112C282.7 112 272 101.3 272 88C272 74.7 282.7 64 296 64zM272 184C272 170.7 282.7 160 296 160C397.6 160 480 242.4 480 344C480 357.3 469.3 368 456 368C442.7 368 432 357.3 432 344C432 268.9 371.1 208 296 208C282.7 208 272 197.3 272 184zM90.4 206.7C99.2 188.8 122.8 186.8 136.9 200.9L265.4 329.4L297.4 297.4C309.9 284.9 330.2 284.9 342.7 297.4C355.2 309.9 355.2 330.2 342.7 342.7L310.7 374.7L439.2 503.2C453.3 517.3 451.2 540.8 433.4 549.7C399.2 566.6 360.8 576.1 320.1 576.1C178.7 576.1 64.1 461.5 64.1 320.1C64.1 279.4 73.6 240.9 90.5 206.8z"/>
                    </svg>
                  </span>
                  <p>No devices found</p>
                  <p class="empty-subtext">Try adjusting your search criteria</p>
                </div>
              </td>
            </tr>
            </tbody>
          </table>
        </div>

        <!-- Paginação -->
        <div class="pagination">
          <button
            class="pagination-btn prev-btn"
            (click)="previousPage()"
            [disabled]="(currentPage$ | async) === 1"
            title="Previous Page"
          >
            <span class="icon-previous">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" fill="currentColor">
                <path d="M566.6 342.6C579.1 330.1 579.1 309.8 566.6 297.3L406.6 137.3C394.1 124.8 373.8 124.8 361.3 137.3C348.8 149.8 348.8 170.1 361.3 182.6L466.7 288L96 288C78.3 288 64 302.3 64 320C64 337.7 78.3 352 96 352L466.7 352L361.3 457.4C348.8 469.9 348.8 490.2 361.3 502.7C373.8 515.2 394.1 515.2 406.6 502.7L566.6 342.7z"/>
              </svg>
            </span>
            Previous
          </button>

          <div class="pagination-info">
            <span class="page-number"><span class="page-total">Page </span> {{ currentPage$ | async }} <span class="page-total">of </span>{{ totalPages$ | async }}</span>
          </div>

          <button
            class="pagination-btn next-btn"
            (click)="nextPage()"
            [disabled]="(currentPage$ | async) === (totalPages$ | async)"
            title="Next Page"
          >
            Next
            <span class="icon-next">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" fill="currentColor">
                <path d="M566.6 342.6C579.1 330.1 579.1 309.8 566.6 297.3L406.6 137.3C394.1 124.8 373.8 124.8 361.3 137.3C348.8 149.8 348.8 170.1 361.3 182.6L466.7 288L96 288C78.3 288 64 302.3 64 320C64 337.7 78.3 352 96 352L466.7 352L361.3 457.4C348.8 469.9 348.8 490.2 361.3 502.7C373.8 515.2 394.1 515.2 406.6 502.7L566.6 342.7z"/>
              </svg>
            </span>
          </button>
        </div>
      </div>
    </div>

    <!-- Modal de descrição -->
    <div class="modal-description" *ngIf="openModalDescription">
      <div class="modal-description-content">
        <div class="modal-header">
          <h3>Device Description</h3>
          <button class="modal-close" (click)="openModalDescription = false" title="Close">
            ×
          </button>
        </div>
        <div class="modal-body">
          <p class="modal-description-text">{{selectedDeviceDescription || 'No description available'}}</p>
        </div>
      </div>
    </div>

    <!-- Componentes de update e delete -->
    <app-update
      *ngIf="openModalUpdate"
      [deviceModel]="deviceModel"
      (sendEventCloseModalUpdate)="getEventCloseModalUpdate()">
    </app-update>

    <app-delete-device
      *ngIf="openModalDelete"
      [deviceModel]="deviceModel"
      (sendEventCloseModalDeviceDelete)="consumerEventCloseModalDeviceDelete()">
    </app-delete-device>
  </div>
</div>
